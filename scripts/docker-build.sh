#!/bin/bash

# ุณูุฑูุจุช ุจูุงุก ุตูุฑ Docker ูููุงุฌูุฉ ุงูุฃูุงููุฉ ูุงูุฎูููุฉ

echo "๐ณ ุจุฏุก ุจูุงุก ุตูุฑ Docker..."

# ุจูุงุก ุงููุดุฑูุน ุฃููุงู
echo "๐จ ุจูุงุก ุงููุดุฑูุน..."
./scripts/build.sh

# ุงูุชุญูู ูู ูุฌุงุญ ุนูููุฉ ุงูุจูุงุก
if [ $? -ne 0 ]; then
  echo "โ ูุดู ุจูุงุก ุงููุดุฑูุน. ูุฑุฌู ุงูุชุญูู ูู ุงูุฃุฎุทุงุก ูุฅุนุงุฏุฉ ุงููุญุงููุฉ."
  exit 1
fi

# ุจูุงุก ุตูุฑุฉ Docker ูููุงุฌูุฉ ุงูุฃูุงููุฉ
echo "๐จ ุจูุงุก ุตูุฑุฉ Docker ูููุงุฌูุฉ ุงูุฃูุงููุฉ..."
docker build -t certificates-frontend -f Dockerfile.frontend .

# ุงูุชุญูู ูู ูุฌุงุญ ุนูููุฉ ุงูุจูุงุก
if [ $? -ne 0 ]; then
  echo "โ ูุดู ุจูุงุก ุตูุฑุฉ Docker ูููุงุฌูุฉ ุงูุฃูุงููุฉ. ูุฑุฌู ุงูุชุญูู ูู ุงูุฃุฎุทุงุก ูุฅุนุงุฏุฉ ุงููุญุงููุฉ."
  exit 1
fi

# ุจูุงุก ุตูุฑุฉ Docker ูููุงุฌูุฉ ุงูุฎูููุฉ
echo "๐จ ุจูุงุก ุตูุฑุฉ Docker ูููุงุฌูุฉ ุงูุฎูููุฉ..."
docker build -t certificates-backend -f Dockerfile.backend .

# ุงูุชุญูู ูู ูุฌุงุญ ุนูููุฉ ุงูุจูุงุก
if [ $? -ne 0 ]; then
  echo "โ ูุดู ุจูุงุก ุตูุฑุฉ Docker ูููุงุฌูุฉ ุงูุฎูููุฉ. ูุฑุฌู ุงูุชุญูู ูู ุงูุฃุฎุทุงุก ูุฅุนุงุฏุฉ ุงููุญุงููุฉ."
  exit 1
fi

echo "โ ุชู ุจูุงุก ุตูุฑ Docker ุจูุฌุงุญ!"
echo "๐ ูุชุดุบูู ุงูุชุทุจูู ุจุงุณุชุฎุฏุงู Docker Composeุ ูู ุจุชูููุฐ ุงูุฃูุฑ ุงูุชุงูู:"
echo "   docker-compose up -d"
echo ""
echo "๐ฆ ูููุดุฑ ุนูู ูุธุงู ุขุฎุฑุ ูู ุฃููุงู ุจุญูุธ ุงูุตูุฑ:"
echo "   docker save certificates-frontend | gzip > certificates-frontend.tar.gz"
echo "   docker save certificates-backend | gzip > certificates-backend.tar.gz"
echo ""
echo "ุซู ููู ุงููููุงุช ุฅูู ุงููุธุงู ุงูุขุฎุฑ ูุชุญููููุง:"
echo "   docker load < certificates-frontend.tar.gz"
echo "   docker load < certificates-backend.tar.gz"
echo ""
echo "ูุฃุฎูุฑุงู ุชุดุบูู ุงูุชุทุจูู ุจุงุณุชุฎุฏุงู Docker Compose."